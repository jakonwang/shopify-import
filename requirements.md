# Shopify商品批量上传系统需求文档

## 1. 项目概述

本系统旨在简化Shopify商品的批量上传流程，通过处理本地文件夹中的商品图片，结合预设的商品信息模板，快速生成符合Shopify导入格式的商品表格。

## 2. 核心功能

### 2.1 文件上传
- 支持文件夹拖拽上传
- 支持多个文件夹批量上传
- 自动识别jpg, png, webp等常见图片格式
- 实时显示上传进度
- 预览文件夹结构和图片内容

### 2.2 模板设置
- 商品标题格式设置（支持变量：{folder_name}, {prefix}, {suffix}）
- 商品描述模板编辑
- 默认价格区间设置
- Shopify必填字段默认值设置
- 模板保存和加载功能

### 2.3 批量处理
- 预览生成的商品信息
- 支持批量修改价格、描述等信息
- 图片自动排序
- 图片压缩和优化
- 批量编辑功能

### 2.4 导出功能
- 导出符合Shopify格式的CSV文件
- 自定义导出文件名
- 导出历史记录
- 选择性导出功能

## 3. 技术要求

### 3.1 前端技术
- HTML5 文件API
- 现代化UI框架
- 响应式设计
- 文件处理库

### 3.2 后端技术
- PHP 7.4+
- MySQL 5.7+
- 文件处理库
- CSV处理库

### 3.3 存储配置
- Windows环境：
  1. 确保public/storage目录存在
  2. 确保public/storage/products目录存在
  3. 设置正确的目录权限
  4. 配置storage_path指向正确的路径

- Linux环境：
  1. 运行 `php artisan storage:link` 创建软链接
  2. 确保storage目录权限正确（通常为755）
  3. 确保web服务器用户有写入权限

## 4. 数据结构

### 4.1 模板数据
```json
{
    "title_format": "{prefix}{folder_name}{suffix}",
    "description_template": "<p>商品描述</p>",
    "default_price": "99.99",
    "default_values": {
        "vendor": "mysite",
        "type": "Product",
        "status": "active"
    }
}
```

### 4.2 商品数据
```json
{
    "handle": "product-handle",
    "title": "Product Title",
    "body_html": "<p>Product description</p>",
    "vendor": "mysite",
    "images": [
        {
            "src": "image_url",
            "position": 1
        }
    ]
}
```

## 5. 使用流程

1. 环境配置
   - 检查存储目录配置
   - 确保图片上传目录可写
   - 验证图片访问URL正确

2. 上传文件夹
   - 将包含商品图片的文件夹拖入上传区域
   - 系统自动识别和预处理图片

3. 设置模板
   - 配置标题格式（使用{folder_name}等变量）
   - 编辑描述模板
   - 设置默认价格和其他信息

4. 预览和调整
   - 查看生成的商品信息
   - 批量修改或单个调整
   - 预览图片排序

5. 导出文件
   - 选择要导出的商品
   - 设置导出文件名
   - 下载CSV文件

## 6. 注意事项

### 6.1 图片处理要求
- 支持的格式：jpg, png, webp
- 最大文件大小：5MB
- 自动压缩：保持质量的同时优化文件大小
- 存储路径：确保正确配置以访问上传的图片

### 6.2 CSV导出要求
- 编码：UTF-8
- 分隔符：逗号
- 必填字段完整性检查

### 6.3 存储配置要求
- 确保storage目录权限正确
- 验证图片URL可以正常访问
- 定期清理临时文件
- 配置正确的文件访问路径

## 7. 已实现功能（v2.0）

### 7.1 文件夹批量上传功能 ✅
- **多文件夹选择**: 使用HTML5 webkitdirectory API实现文件夹批量选择
- **自动分组处理**: 按文件夹名称自动分组图片文件，每个文件夹生成一个商品
- **智能文件过滤**: 自动过滤非图片文件和超大文件（>5MB）
- **实时预览**: 显示选中的文件夹数量、图片数量和商品预览信息
- **去重处理**: 自动检测并跳过重复的文件夹名称
- **多次选择**: 支持多次选择文件夹，系统会自动合并和去重
- **详细预览**: 可展开查看每个文件夹的详细文件路径信息

### 7.2 模板驱动的商品生成 ✅
- **标题格式化**: 支持{folder_name}, {prefix}, {suffix}变量替换
- **模板应用**: 统一应用供应商、类型、价格、描述等模板属性
- **商品Handle生成**: 自动生成唯一的商品标识符

### 7.3 Shopify标准CSV导出 ✅
- **完整格式支持**: 导出符合Shopify产品导入标准的CSV文件
- **图片信息包含**: 自动包含商品图片URL、位置和Alt文本
- **UTF-8编码**: 支持中文字符，Excel兼容
- **多图片支持**: 每张图片占用一行，第一行包含完整商品信息

### 7.4 用户体验优化 ✅
- **现代化界面**: 使用Vue 3 + Element Plus构建响应式界面
- **操作引导**: 清晰的步骤提示和状态反馈
- **错误处理**: 完善的错误提示和重试机制
- **批量操作**: 支持一次性处理多个商品文件夹

### 7.5 技术架构改进 ✅
- **前后端分离**: Vue.js前端 + Laravel API后端
- **文件验证**: 服务器端图片格式和大小验证
- **关系管理**: 商品与图片的数据库关系管理
- **日志记录**: 完整的操作日志和错误追踪

## 8. 系统使用流程

### 8.1 初始化配置
1. 检查存储配置：
   ```bash
   # Windows环境
   - 确认public/storage目录存在
   - 确认public/storage/products目录存在
   - 设置目录权限

   # Linux环境
   php artisan storage:link
   chmod -R 755 storage
   chown -R www-data:www-data storage
   ```

2. 验证图片访问：
   - 上传测试图片
   - 确认图片URL可以正常访问
   - 检查图片存储路径配置

### 8.2 模板创建
1. 导航到"模板管理"页面
2. 点击"新建模板"
3. 填写模板信息：
   - 模板名称: 便于识别的名称
   - 供应商: 商品供应商名称
   - 商品类型: 商品分类
   - 标题格式: 使用{folder_name}等变量
   - 商品描述: HTML格式描述
   - 默认价格和对比价格
   - 商品状态: 启用/草稿

### 8.3 文件夹批量上传
1. 准备商品文件夹结构：
   ```
   商品根目录/
   ├── 商品A/
   │   ├── 图片1.jpg
   │   ├── 图片2.jpg
   │   └── 图片3.jpg
   ├── 商品B/
   │   ├── 主图.jpg
   │   └── 详情图.jpg
   └── 商品C/
       └── 产品图.jpg
   ```

2. 在首页选择已创建的模板
3. 点击上传区域选择商品根目录
4. 系统自动识别并分组所有子文件夹
5. 预览自动分组的商品信息
6. 支持多次选择文件夹，系统会自动合并和去重
7. 点击"开始上传"进行批量处理

### 8.4 文件夹选择优化功能 ✅
- **智能去重**: 自动检测重复文件夹名称，避免重复上传
- **多次选择**: 支持多次选择不同的文件夹，系统会自动合并
- **详细预览**: 可展开查看每个文件夹的完整文件路径
- **实时反馈**: 显示选择状态、文件数量和上传进度
- **错误处理**: 自动跳过非图片文件和超大文件，并给出提示

### 8.3 CSV导出和Shopify导入
1. 上传完成后在商品列表查看结果
2. 点击"导出CSV"下载Shopify格式文件
3. 登录Shopify后台
4. 导航到"产品"页面
5. 点击"导入"并上传CSV文件
6. 确认导入设置并完成批量导入

## 9. 已完成的高级功能（v3.0）

### 9.1 完整Shopify字段支持 ✅
- **产品选项支持**: 支持尺寸、颜色、材质等3个自定义选项
- **变体信息管理**: 完整支持重量、库存、条形码、税收等变体字段
- **SEO优化功能**: 支持自定义SEO标题和描述
- **Google Shopping集成**: 支持Google购物所需的所有字段
- **集合管理**: 支持商品集合分类

### 9.2 现代化界面设计 ✅
- **卡片式布局**: 采用现代化的卡片式设计，提升用户体验
- **响应式设计**: 支持各种屏幕尺寸，移动端友好
- **清晰的信息架构**: 分组表单设计，字段组织更合理
- **实时预览**: 模板选择时提供详细的预览信息

### 9.3 富文本编辑器 ✅
- **自定义编辑器**: 集成富文本编辑器，支持格式化文本
- **HTML输出**: 自动生成HTML格式的商品描述
- **工具栏功能**: 支持粗体、斜体、下划线、列表、链接等格式
- **实时预览**: 所见即所得的编辑体验

### 9.4 完整CSV导出格式 ✅
- **标准Shopify格式**: 完全兼容Shopify产品导入标准
- **完整字段映射**: 包含所有47个Shopify标准字段
- **绝对URL路径**: 图片路径使用完整的绝对URL
- **多语言支持**: UTF-8编码确保中文字符正确显示

### 9.5 模板系统增强 ✅
- **字段验证**: 完整的表单验证和数据校验
- **默认值管理**: 智能的默认值设置和继承
- **模板继承**: 创建产品时完整继承模板所有字段
- **灵活配置**: 支持产品选项、SEO、Google Shopping等高级配置

## 10. CSV导出字段对照表

| 中文名称 | Shopify字段名 | 数据类型 | 说明 |
|---------|--------------|---------|------|
| 商品句柄 | Handle | 文本 | 商品唯一标识符 |
| 商品标题 | Title | 文本 | 商品名称 |
| 商品描述 | Body (HTML) | HTML | 支持富文本格式 |
| 供应商 | Vendor | 文本 | 品牌或供应商名称 |
| 商品类型 | Type | 文本 | 商品分类 |
| 标签 | Tags | 文本 | 商品标签，逗号分隔 |
| 发布状态 | Published | 布尔值 | TRUE/FALSE |
| 选项1名称 | Option1 Name | 文本 | 如：尺寸 |
| 选项1值 | Option1 Value | 文本 | 如：M |
| 选项2名称 | Option2 Name | 文本 | 如：颜色 |
| 选项2值 | Option2 Value | 文本 | 如：红色 |
| 选项3名称 | Option3 Name | 文本 | 如：材质 |
| 选项3值 | Option3 Value | 文本 | 如：棉质 |
| 变体SKU | Variant SKU | 文本 | 库存单位 |
| 变体重量 | Variant Grams | 数字 | 克为单位 |
| 库存跟踪 | Variant Inventory Tracker | 文本 | shopify/none |
| 库存数量 | Variant Inventory Qty | 数字 | 库存数量 |
| 库存政策 | Variant Inventory Policy | 文本 | continue/deny |
| 配送服务 | Variant Fulfillment Service | 文本 | manual/automatic |
| 变体价格 | Variant Price | 数字 | 销售价格 |
| 对比价格 | Variant Compare At Price | 数字 | 原价 |
| 需要运费 | Variant Requires Shipping | 布尔值 | TRUE/FALSE |
| 需要缴税 | Variant Taxable | 布尔值 | TRUE/FALSE |
| 条形码 | Variant Barcode | 文本 | 商品条形码 |
| 图片地址 | Image Src | URL | 完整图片URL |
| 图片位置 | Image Position | 数字 | 图片排序 |
| 图片说明 | Image Alt Text | 文本 | 图片替代文本 |
| 礼品卡 | Gift Card | 布尔值 | TRUE/FALSE |
| SEO标题 | SEO Title | 文本 | 搜索引擎标题 |
| SEO描述 | SEO Description | 文本 | 搜索引擎描述 |
| Google类别 | Google Shopping Category | 文本 | Google购物类别 |
| 性别 | Google Shopping Gender | 文本 | 目标性别 |
| 年龄组 | Google Shopping Age Group | 文本 | 目标年龄组 |
| 制造商编号 | Google Shopping MPN | 文本 | 制造商零件号 |
| 广告分组 | Google Shopping AdWords Grouping | 文本 | 广告组 |
| 广告标签 | Google Shopping AdWords Labels | 文本 | 广告标签 |
| 商品状况 | Google Shopping Condition | 文本 | new/used/refurbished |
| 自定义产品 | Google Shopping Custom Product | 布尔值 | TRUE/FALSE |
| 自定义标签0-4 | Google Shopping Custom Label 0-4 | 文本 | 自定义标签 |
| 变体图片 | Variant Image | URL | 变体专用图片 |
| 重量单位 | Variant Weight Unit | 文本 | kg/g/lb/oz |
| 税务代码 | Variant Tax Code | 文本 | 税务分类代码 |
| 成本价格 | Cost per item | 数字 | 单件成本 |
| 状态 | Status | 文本 | active/draft |
| 集合 | Collection | 文本 | 商品集合 |

## 11. 后续优化计划

- 支持更多图片格式（SVG, TIFF等）
- 添加图片批量编辑功能（裁剪、压缩、水印）
- 支持导入现有CSV模板进行批量修改
- 支持多语言商品信息
- 集成图片CDN加速服务
- 添加批量价格调整功能
- 支持商品标签自动生成
- 集成库存管理系统 

## 12. 界面现代化改造（v4.0）

### 12.1 设计系统升级 ✅
- **现代化设计变量**: 建立完整的CSS变量系统，包含颜色、间距、阴影、圆角等
- **玻璃形态设计**: 采用毛玻璃效果和半透明背景，提升界面层次感
- **渐变背景**: 使用现代化的渐变背景和装饰元素
- **统一配色方案**: 基于蓝紫色调的现代化配色体系

### 12.2 主应用布局重构 ✅
- **侧边栏导航**: 全新的现代化侧边栏，支持折叠和展开
- **顶部导航栏**: 干净简洁的顶部栏，包含页面标题和用户操作
- **页面切换动画**: 平滑的页面过渡效果
- **响应式布局**: 适配不同屏幕尺寸的自适应设计

### 12.3 首页界面升级 ✅
- **统计卡片**: 显示待上传商品、图片文件、已创建商品的实时统计
- **现代化上传区域**: 
  - 大尺寸图标和清晰的状态提示
  - 进度指示器和动画效果
  - 拖拽式上传体验
- **文件夹预览**: 
  - 网格式布局展示选中的商品文件夹
  - 卡片式设计，每个文件夹独立显示
  - 文件标签化展示
- **模板选择区域**:
  - 详细的模板预览卡片
  - 选项和字段的可视化展示
  - 空状态的优雅处理

### 12.4 商品管理优化 ✅
- **表格现代化**: 
  - 条纹样式和悬停效果
  - 商品名称和句柄的层次化显示
  - 状态标签的视觉优化
- **操作按钮**: 现代化的按钮设计，支持图标和文字
- **空状态设计**: 友好的空状态提示和引导

### 12.5 模板管理页面重构 ✅
- **卡片网格布局**: 
  - 响应式网格系统
  - 悬停效果和阴影层次
  - 详细信息的结构化展示
- **创建/编辑对话框**:
  - 分组表单设计
  - 图标化的区块标题
  - 网格式表单布局
  - 高级选项的折叠设计
- **背景装饰**: 动态背景装饰元素

### 12.6 富文本编辑器升级 ✅
- **工具栏分组**: 按功能分组的工具按钮
- **现代化图标**: 使用Element Plus图标库
- **玻璃形态效果**: 半透明背景和模糊效果
- **快捷键支持**: Ctrl+B/I/U快捷键
- **字数统计**: 可选的字数统计功能
- **滚动条美化**: 自定义滚动条样式

### 12.7 全局样式系统 ✅
- **CSS变量系统**: 
  - 完整的颜色色阶（50-900）
  - 间距、圆角、阴影标准化
  - 字体和字号规范
- **工具类库**:
  - 玻璃效果类
  - 悬停提升效果
  - 渐变背景
  - 动画工具类
  - Flexbox和Grid布局类
- **组件样式覆盖**: Element Plus组件的现代化样式覆盖

### 12.8 动画和交互效果 ✅
- **页面过渡**: 平滑的页面切换动画
- **悬停效果**: 卡片悬停提升和阴影变化
- **按钮交互**: 按下、悬停的反馈效果
- **加载动画**: 旋转、脉冲等加载状态动画
- **背景装饰**: 浮动的装饰元素动画

### 12.9 响应式设计优化 ✅
- **移动端适配**: 
  - 侧边栏在移动端的自动隐藏
  - 网格布局的响应式调整
  - 按钮和间距的移动端优化
- **平板适配**: 中等屏幕的布局优化
- **桌面端**: 大屏幕的最佳展示效果

### 12.10 用户体验提升 ✅
- **视觉层次**: 通过颜色、大小、间距建立清晰的视觉层次
- **信息架构**: 重新组织页面信息，提高可读性
- **交互反馈**: 丰富的交互反馈，让用户操作更有确定性
- **错误处理**: 优雅的错误状态和空状态处理
- **性能优化**: CSS过渡和动画的性能优化

### 12.11 设计规范 ✅
- **颜色规范**: 
  - 主色：蓝色系（#3b82f6）
  - 辅助色：黄色系（#eab308）
  - 成功色：绿色系（#22c55e）
  - 警告色：橙色系（#f59e0b）
  - 错误色：红色系（#ef4444）
- **字体规范**: Inter字体族，支持中文显示
- **间距规范**: 基于4px的间距系统
- **圆角规范**: 从2px到24px的圆角等级
- **阴影规范**: 6个层级的阴影深度

### 12.12 技术实现 ✅
- **CSS自定义属性**: 大量使用CSS变量，支持主题切换
- **现代CSS特性**: 
  - backdrop-filter毛玻璃效果
  - CSS Grid和Flexbox布局
  - CSS动画和过渡
- **组件化设计**: 可复用的样式组件和工具类
- **性能优化**: 
  - 硬件加速的动画
  - 合理的重绘和重排控制
  - 响应式图片和资源优化

## 13. 界面现代化技术细节

### 13.1 设计系统架构
```css
:root {
  /* 颜色系统 - 每种颜色50-900的完整色阶 */
  --primary-500: #3b82f6;
  --success-500: #22c55e;
  
  /* 语义化颜色 */
  --text-primary: var(--gray-900);
  --bg-primary: #ffffff;
  
  /* 间距系统 - 基于4px网格 */
  --space-sm: 0.5rem;
  --space-md: 1rem;
  
  /* 阴影系统 - 6个层级 */
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
}
```

### 13.2 玻璃形态实现
```css
.glass-effect {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}
```

### 13.3 动画性能优化
- 使用`transform`和`opacity`进行动画，避免重排
- 利用`will-change`属性提示浏览器优化
- 合理使用`transition-timing-function`提升动画质感

### 13.4 响应式断点
- 移动端：< 768px
- 平板端：768px - 1024px  
- 桌面端：> 1024px

## 14. 未来优化方向

### 14.1 暗黑模式支持
- 建立暗黑模式的颜色变量系统
- 实现主题切换功能
- 优化暗黑模式下的可读性

### 14.2 微交互优化
- 添加更多的加载状态动画
- 实现拖拽排序功能
- 增强表单验证的视觉反馈

### 14.3 可访问性改进
- 改善键盘导航支持
- 优化屏幕阅读器兼容性
- 增强颜色对比度

### 14.4 性能进一步优化
- 实现虚拟滚动
- 图片懒加载
- 组件级别的代码分割 

## 10. 故障排除

### 10.1 图片访问问题
1. 检查存储配置
   - 验证storage目录结构
   - 确认目录权限
   - 检查web服务器配置

2. URL访问问题
   - 确认图片URL格式正确
   - 验证storage软链接配置
   - 检查web服务器重写规则

3. 常见解决方案
   - 重新创建storage软链接
   - 调整目录权限
   - 更新.htaccess配置
   - 检查nginx配置文件

### 10.2 文件权限问题
1. Windows环境
   - 确保IIS_IUSRS或IUSR有写入权限
   - 检查文件共享权限
   - 验证应用程序池身份权限

2. Linux环境
   - 设置正确的目录权限（755）
   - 确保web服务器用户有写入权限
   - 检查SELinux配置

## 11. 部署说明

### 11.1 Windows部署
1. 存储配置
   ```
   - 创建public/storage目录
   - 创建public/storage/products目录
   - 设置目录权限
   - 配置web.config（如果使用IIS）
   ```

2. Web服务器配置
   ```
   # IIS URL重写规则
   <rule name="storage_access">
       <match url="^storage/(.*)$" />
       <action type="Rewrite" url="public/storage/{R:1}" />
   </rule>
   ```

### 11.2 Linux部署
1. 存储配置
   ```bash
   # 创建软链接
   php artisan storage:link

   # 设置权限
   chmod -R 755 storage
   chown -R www-data:www-data storage
   ```

2. Nginx配置
   ```nginx
   location /storage {
       try_files $uri $uri/ /index.php?$query_string;
   }
   ```

### 11.3 验证部署
1. 上传测试
   - 上传测试图片
   - 验证图片存储位置
   - 确认图片访问URL

2. 权限测试
   - 测试图片上传
   - 验证图片访问
   - 检查日志文件权限 